<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; }
        #player-container { position: relative; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; }
        #player { max-width: calc(100vh * 9 / 16); width: 100%; height: 100%; }
        #unmuteButton {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 60vw; max-width: 300px; padding: 5vw 3vw; font-size: 4.5vw;
            max-font-size: 28px; font-weight: bold; color: white; background-color: rgba(0, 0, 0, 0.75);
            border: 3px solid white; border-radius: 20px; cursor: pointer; z-index: 10;
            white-space: normal; word-break: keep-all; text-align: center; display: flex;
            justify-content: center; align-items: center; box-sizing: border-box; line-height: 1.3;
        }
        #errorMessage {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: white; background-color: rgba(255, 0, 0, 0.8); padding: 20px;
            border-radius: 10px; text-align: center; max-width: 80%; z-index: 20;
            display: none;
        }
        @media (max-width: 400px) {
            #unmuteButton { font-size: 20px; }
        }
    </style>
    <meta property="og:title" content="나만의 쇼츠 플레이어"/>
    <meta property="og:description" content="최신 쇼츠를 연속으로 재생합니다"/>
    <meta property="og:image" content=""/>
    <meta property="og:url" content=""/>
    <meta property="og:type" content="website" />
</head>
<body>
    <div id="player-container">
        <div id="player"></div>
        <button id="unmuteButton">터치하여 소리 켜기</button>
        <div id="errorMessage">
            <h3>재생 오류</h3>
            <p>이 영상은 재생할 수 없습니다. 다음 영상으로 넘어갑니다...</p>
        </div>
    </div>
    <script>
        const videoIds = ["QCsOaLOwgHA","FWELfA3zdrI","cTQMT01Ezks","vQHdlRGL7NM","pMJLwTvTgkc","OlnF-Xce20U","K09QX6LF0e4","CQk3dOjBA64"];
        let player;
        let currentVideoIndex = 0;
        let retryCount = 0;
        const maxRetries = 3;

        function onYouTubeIframeAPIReady() {
            if (videoIds && videoIds.length > 0) {
                loadVideo(currentVideoIndex);
            } else {
                document.getElementById('player-container').innerHTML = "<h1>재생할 영상이 없습니다.</h1>";
            }
        }

        function loadVideo(index) {
            if (index >= videoIds.length) {
                // 모든 영상을 다 재생했으면 처음부터 다시
                index = 0;
                currentVideoIndex = 0;
            }

            const videoId = videoIds[index];
            if (player) {
                player.loadVideoById(videoId);
            } else {
                player = new YT.Player('player', {
                    height: '100%', 
                    width: '100%', 
                    videoId: videoId,
                    playerVars: { 
                        'autoplay': 1, 'mute': 1, 'controls': 1, 'rel': 0, 
                        'playsinline': 1
                    },
                    events: { 
                        'onReady': onPlayerReady, 
                        'onStateChange': onPlayerStateChange,
                        'onError': onPlayerError
                    }
                });
            }
        }

        function onPlayerReady(event) {
            const unmuteBtn = document.getElementById('unmuteButton');
            if (player.isMuted()) { 
                unmuteBtn.style.display = 'flex'; 
            }
            unmuteBtn.addEventListener('click', () => {
                player.unMute();
                unmuteBtn.style.display = 'none';
            });
            
            // 에러 메시지 숨김
            document.getElementById('errorMessage').style.display = 'none';
            retryCount = 0;
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.PLAYING) {
                const unmuteBtn = document.getElementById('unmuteButton');
                if (!player.isMuted()) {
                    unmuteBtn.style.display = 'none';
                }
                // 에러 메시지 숨김
                document.getElementById('errorMessage').style.display = 'none';
            } else if (event.data === YT.PlayerState.ENDED) {
                // 영상이 끝나면 다음 영상으로
                playNextVideo();
            }
        }

        function onPlayerError(event) {
            console.log('플레이어 오류:', event.data);
            
            // 오류 메시지 표시
            const errorMsg = document.getElementById('errorMessage');
            errorMsg.style.display = 'block';
            
            // 3초 후 다음 영상으로 넘어가기
            setTimeout(() => {
                errorMsg.style.display = 'none';
                playNextVideo();
            }, 3000);
        }

        function playNextVideo() {
            currentVideoIndex++;
            if (currentVideoIndex >= videoIds.length) {
                currentVideoIndex = 0; // 처음부터 다시 재생
            }
            
            // 최대 재시도 횟수 확인
            if (retryCount < maxRetries) {
                retryCount++;
                loadVideo(currentVideoIndex);
            } else {
                document.getElementById('player-container').innerHTML = 
                    "<h1 style='color: white; text-align: center;'>모든 영상에서 오류가 발생했습니다.<br>잠시 후 다시 시도해주세요.</h1>";
            }
        }
    </script>
    <script async src="https://www.youtube.com/iframe_api"></script>
</body>
</html>